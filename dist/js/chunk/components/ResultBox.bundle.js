(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{104:function(t,e,a){"use strict";(function(t){var i=a(146),s=a(2),n=a(0);function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function r(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){d(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function d(t,e,a){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var i=a.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}e.a={components:{GoogleSupport:()=>a.e(1).then(a.bind(null,141))},filters:{},props:{},data:()=>({ResultList:[],luckyOption:{false:"未中獎",true:"中獎"},editCandidateInfo:!1,showGooglSupport:!1}),computed:r({},Object(s.c)(["config","triggerOpenResult","candidateList","prizeList","prizeMapping"])),watch:{triggerOpenResult(){this.triggerOpenResult?t(this.$refs.box).modal("show"):t(this.$refs.box).modal("hide")}},created(){},mounted(){var e=this;t(e.$refs.box).bind("shown.bs.modal",()=>{e.formatResultList(),n.g.mixpanel("ResultOpen_click"),n.g.gtag("event","ResultOpen_click")}),t(e.$refs.box).bind("hidden.bs.modal",()=>{n.g.mixpanel("ResultClose_click"),n.g.gtag("event","ResultClose_click")}),t(e.$refs.download).bind("shown.bs.modal",()=>{e.showGooglSupport=!0}),t(e.$refs.download).bind("hidden.bs.modal",()=>{e.showGooglSupport=!1}),e.triggerOpenResult?t(e.$refs.box).modal("show"):t(e.$refs.box).modal("hide")},updated(){},destroyed(){},methods:r(r(r({},Object(s.b)({})),Object(s.d)({setCandidateInfo:"setCandidateInfo"})),{},{formatResultList(){var t=JSON.parse(JSON.stringify(this.prizeMapping)),e=[],a=JSON.parse(JSON.stringify(this.candidateList));(a=a.filter(t=>!1===t.del)).forEach(a=>{var i=a,s=[],n=[];i.award.forEach(e=>{t[e]&&(s.push(e),n.push(t[e].title))}),i.award=s,i.award_title=n.join(","),i.haveAward=s.length>0,e.push(i)}),e=e.sort((t,e)=>t.haveAward<e.haveAward?1:t.haveAward===e.haveAward?0:-1),this.ResultList=e},openEdit(t){n.g.mixpanel("ResultEdit_click",t),n.g.gtag("event","ResultEdit_click",t),this.editCandidateInfo=t},save(){var t=JSON.parse(JSON.stringify(this.prizeList)),e={};t.forEach(t=>{e[t.title]=t});var a=[];"true"===this.editCandidateInfo.haveAward&&this.editCandidateInfo.award_title.split(",").forEach(t=>{t=t.trim(),e[t]&&a.push(e[t].prize_sn)});var i={sn:this.editCandidateInfo.sn,name:this.editCandidateInfo.name,pos:this.editCandidateInfo.pos,award:a,del:this.editCandidateInfo.del};this.setCandidateInfo(i),this.editCandidateInfo=!1,this.formatResultList(),n.g.mixpanel("ResultEditSave_click",i),n.g.gtag("event","ResultEditSave_click",i)},download(){var e=this;t(e.$refs.box).modal("hide"),t(e.$refs.download).modal("show"),clearTimeout(e.downloadTimer);var a=n.f.randRange(2e3,5e3);e.downloadTimer=setTimeout(()=>{var a=i.unparse(e.ResultList,{header:["姓名","職位","獎項"],columns:["name","pos","award_title"]}),s="data:text/csv;charset=utf-8,".concat(a),o=encodeURI(s),r=document.createElement("a");r.style.display="none",r.setAttribute("href",o),r.setAttribute("download","".concat(e.config.webTitle,"中獎名單.csv")),document.body.appendChild(r),r.click(),n.g.mixpanel("ResultDownload_click",{csv:a}),n.g.gtag("event","ResultDownload_click",{csv:a}),t(e.$refs.box).modal("show"),t(e.$refs.download).modal("hide")},a)}})}}).call(this,a(14))},360:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",[e("div",{ref:"box",staticClass:"modal result-modal",attrs:{id:"ResultBox",tabindex:"-1",role:"dialog"}},[e("div",{staticClass:"modal-dialog modal-lg",attrs:{role:"document"}},[e("div",{staticClass:"modal-content"},[t._m(0),t._v(" "),e("div",{staticClass:"modal-body"},[t.ResultList.length>0?[e("table",{staticClass:"table"},[t._m(1),t._v(" "),e("tbody",[t._l(t.ResultList,(function(a,i){return[t.editCandidateInfo.sn===a.sn?[e("tr",{key:a.sn},[e("th",{attrs:{scope:"row"}},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.editCandidateInfo.haveAward,expression:"editCandidateInfo.haveAward"}],staticClass:"form-control",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.editCandidateInfo,"haveAward",e.target.multiple?a:a[0])}}},t._l(t.luckyOption,(function(a,i){return e("option",{key:i,domProps:{value:i}},[t._v("\n                                                        "+t._s(a)+"\n                                                    ")])})),0)]),t._v(" "),e("td",[e("div",[t._v(t._s(a.name))]),t._v(" "),e("div",[e("small",[t._v(t._s(a.pos))])])]),t._v(" "),e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.editCandidateInfo.award_title,expression:"editCandidateInfo.award_title"}],staticClass:"form-control",domProps:{value:t.editCandidateInfo.award_title},on:{input:function(e){e.target.composing||t.$set(t.editCandidateInfo,"award_title",e.target.value)}}})]),t._v(" "),e("td",[e("button",{staticClass:"btn btn-info",on:{click:function(e){return t.save()}}},[e("i",{staticClass:"fas fa-save"})]),t._v(" "),e("button",{staticClass:"btn btn-warning",on:{click:function(e){t.editCandidateInfo=!1}}},[e("i",{staticClass:"fas fa-times"})])])])]:[e("tr",{key:a.sn},[e("th",{attrs:{scope:"row"}},[t._v("\n                                                "+t._s(t.luckyOption[a.haveAward])+"\n                                            ")]),t._v(" "),e("td",[e("div",[t._v(t._s(a.name))]),t._v(" "),e("div",[e("small",[t._v(t._s(a.pos))])])]),t._v(" "),e("td",[t._v(t._s(a.award_title?a.award_title:"--"))]),t._v(" "),e("td",[e("button",{staticClass:"btn btn-success",on:{click:function(e){return t.openEdit(a)}}},[e("i",{staticClass:"fas fa-edit"})])])])]]}))],2)]),t._v(" "),e("google-support",{attrs:{trigger:t.triggerOpenResult}})]:e("h4",{staticClass:"text-center p-3"},[t._v("\n                        無任何可下載的內容\n                    ")])],2),t._v(" "),e("div",{staticClass:"modal-footer"},[e("div",{staticClass:"col-6 text-left"}),t._v(" "),e("div",{staticClass:"col-6 text-right"},[e("button",{staticClass:"btn btn-primary download-btn",attrs:{type:"button",disabled:0===t.ResultList.length},on:{click:t.download}},[t._v("\n                            下載\n                        ")])])])])])]),t._v(" "),e("div",{ref:"download",staticClass:"modal result-modal",attrs:{tabindex:"-1",role:"dialog","data-backdrop":"static","data-keyboard":"false"}},[e("div",{staticClass:"modal-dialog modal-lg",attrs:{role:"document"}},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-body"},[t._m(2),t._v(" "),e("h5",{staticClass:"text-center",staticStyle:{"font-size":"30px"}},[t._v("\n                        資料處理中\n                    ")]),t._v(" "),t.showGooglSupport?e("google-support"):t._e()],1)])])])])};i._withStripped=!0;var s=a(104).a,n=a(9),o=Object(n.a)(s,i,[function(){var t=this._self._c;return t("div",{staticClass:"modal-header"},[t("h5",{staticClass:"modal-title"},[t("i",{staticClass:"fas fa-vote-yea"}),this._v("\n                        中獎名單\n                    ")]),this._v(" "),t("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[t("span",{attrs:{"aria-hidden":"true"}},[this._v("×")])])])},function(){var t=this._self._c;return t("thead",[t("tr",[t("th",{staticStyle:{width:"15%"}},[this._v("\n                                        #\n                                    ")]),this._v(" "),t("th",{staticStyle:{width:"30%"}},[this._v("\n                                        姓名\n                                    ")]),this._v(" "),t("th",[this._v("獎項")]),this._v(" "),t("th",{staticStyle:{width:"20%"}},[this._v("\n                                        功能\n                                    ")])])])},function(){var t=this._self._c;return t("p",{staticClass:"text-center mb-3",staticStyle:{"font-size":"50px"}},[t("i",{staticClass:"fa-spin fas fa-sync"})])}],!1,null,"69947e2e",null);e.default=o.exports}}]);