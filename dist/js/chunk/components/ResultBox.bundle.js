(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{104:function(t,e,a){"use strict";(function(t){var i=a(146),n=a(2),s=a(0);function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function d(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){r(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function r(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}e.a={components:{GoogleSupport:function(){return a.e(1).then(a.bind(null,141))}},filters:{},props:{},data:function(){return{ResultList:[],luckyOption:{false:"未中獎",true:"中獎"},editCandidateInfo:!1,showGooglSupport:!1}},computed:d({},Object(n.c)(["config","triggerOpenResult","candidateList","prizeList","prizeMapping"])),watch:{triggerOpenResult:function(){this.triggerOpenResult?t(this.$refs.box).modal("show"):t(this.$refs.box).modal("hide")}},created:function(){},mounted:function(){var e=this;t(e.$refs.box).bind("shown.bs.modal",(function(){e.formatResultList(),s.g.mixpanel("ResultOpen_click"),s.g.gtag("event","ResultOpen_click")})),t(e.$refs.box).bind("hidden.bs.modal",(function(){s.g.mixpanel("ResultClose_click"),s.g.gtag("event","ResultClose_click")})),t(e.$refs.download).bind("shown.bs.modal",(function(){e.showGooglSupport=!0})),t(e.$refs.download).bind("hidden.bs.modal",(function(){e.showGooglSupport=!1})),e.triggerOpenResult?t(e.$refs.box).modal("show"):t(e.$refs.box).modal("hide")},updated:function(){},destroyed:function(){},methods:d(d(d({},Object(n.b)({})),Object(n.d)({setCandidateInfo:"setCandidateInfo"})),{},{formatResultList:function(){var t=JSON.parse(JSON.stringify(this.prizeMapping)),e=[],a=JSON.parse(JSON.stringify(this.candidateList));(a=a.filter((function(t){return!1===t.del}))).forEach((function(a){var i=a,n=[],s=[];i.award.forEach((function(e){t[e]&&(n.push(e),s.push(t[e].title))})),i.award=n,i.award_title=s.join(","),i.haveAward=n.length>0,e.push(i)})),e=e.sort((function(t,e){return t.haveAward<e.haveAward?1:t.haveAward===e.haveAward?0:-1})),this.ResultList=e},openEdit:function(t){s.g.mixpanel("ResultEdit_click",t),s.g.gtag("event","ResultEdit_click",t),this.editCandidateInfo=t},save:function(){var t=JSON.parse(JSON.stringify(this.prizeList)),e={};t.forEach((function(t){e[t.title]=t}));var a=[];"true"===this.editCandidateInfo.haveAward&&this.editCandidateInfo.award_title.split(",").forEach((function(t){t=t.trim(),e[t]&&a.push(e[t].prize_sn)}));var i={sn:this.editCandidateInfo.sn,name:this.editCandidateInfo.name,pos:this.editCandidateInfo.pos,award:a,del:this.editCandidateInfo.del};this.setCandidateInfo(i),this.editCandidateInfo=!1,this.formatResultList(),s.g.mixpanel("ResultEditSave_click",i),s.g.gtag("event","ResultEditSave_click",i)},download:function(){var e=this;t(e.$refs.box).modal("hide"),t(e.$refs.download).modal("show"),clearTimeout(e.downloadTimer);var a=s.f.randRange(2e3,5e3);e.downloadTimer=setTimeout((function(){var a=i.unparse(e.ResultList,{header:["姓名","職位","獎項"],columns:["name","pos","award_title"]}),n="data:text/csv;charset=utf-8,".concat(a),o=encodeURI(n),d=document.createElement("a");d.style.display="none",d.setAttribute("href",o),d.setAttribute("download","".concat(e.config.webTitle,"中獎名單.csv")),document.body.appendChild(d),d.click(),s.g.mixpanel("ResultDownload_click",{csv:a}),s.g.gtag("event","ResultDownload_click",{csv:a}),t(e.$refs.box).modal("show"),t(e.$refs.download).modal("hide")}),a)}})}}).call(this,a(14))},360:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{ref:"box",staticClass:"modal result-modal",attrs:{id:"ResultBox",tabindex:"-1",role:"dialog"}},[a("div",{staticClass:"modal-dialog modal-lg",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[t._m(0),t._v(" "),a("div",{staticClass:"modal-body"},[t.ResultList.length>0?[a("table",{staticClass:"table"},[t._m(1),t._v(" "),a("tbody",[t._l(t.ResultList,(function(e,i){return[t.editCandidateInfo.sn===e.sn?[a("tr",{key:e.sn},[a("th",{attrs:{scope:"row"}},[a("select",{directives:[{name:"model",rawName:"v-model",value:t.editCandidateInfo.haveAward,expression:"editCandidateInfo.haveAward"}],staticClass:"form-control",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.editCandidateInfo,"haveAward",e.target.multiple?a:a[0])}}},t._l(t.luckyOption,(function(e,i){return a("option",{key:i,domProps:{value:i}},[t._v("\n                                                        "+t._s(e)+"\n                                                    ")])})),0)]),t._v(" "),a("td",[a("div",[t._v(t._s(e.name))]),t._v(" "),a("div",[a("small",[t._v(t._s(e.pos))])])]),t._v(" "),a("td",[a("input",{directives:[{name:"model",rawName:"v-model",value:t.editCandidateInfo.award_title,expression:"editCandidateInfo.award_title"}],staticClass:"form-control",domProps:{value:t.editCandidateInfo.award_title},on:{input:function(e){e.target.composing||t.$set(t.editCandidateInfo,"award_title",e.target.value)}}})]),t._v(" "),a("td",[a("button",{staticClass:"btn btn-info",on:{click:function(e){return t.save()}}},[a("i",{staticClass:"fas fa-save"})]),t._v(" "),a("button",{staticClass:"btn btn-warning",on:{click:function(e){t.editCandidateInfo=!1}}},[a("i",{staticClass:"fas fa-times"})])])])]:[a("tr",{key:e.sn},[a("th",{attrs:{scope:"row"}},[t._v("\n                                                "+t._s(t.luckyOption[e.haveAward])+"\n                                            ")]),t._v(" "),a("td",[a("div",[t._v(t._s(e.name))]),t._v(" "),a("div",[a("small",[t._v(t._s(e.pos))])])]),t._v(" "),a("td",[t._v(t._s(e.award_title?e.award_title:"--"))]),t._v(" "),a("td",[a("button",{staticClass:"btn btn-success",on:{click:function(a){return t.openEdit(e)}}},[a("i",{staticClass:"fas fa-edit"})])])])]]}))],2)]),t._v(" "),a("google-support",{attrs:{trigger:t.triggerOpenResult}})]:a("h4",{staticClass:"text-center p-3"},[t._v("\n                        無任何可下載的內容\n                    ")])],2),t._v(" "),a("div",{staticClass:"modal-footer"},[a("div",{staticClass:"col-6 text-left"}),t._v(" "),a("div",{staticClass:"col-6 text-right"},[a("button",{staticClass:"btn btn-primary download-btn",attrs:{type:"button",disabled:0===t.ResultList.length},on:{click:t.download}},[t._v("\n                            下載\n                        ")])])])])])]),t._v(" "),a("div",{ref:"download",staticClass:"modal result-modal",attrs:{tabindex:"-1",role:"dialog","data-backdrop":"static","data-keyboard":"false"}},[a("div",{staticClass:"modal-dialog modal-lg",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-body"},[t._m(2),t._v(" "),a("h5",{staticClass:"text-center",staticStyle:{"font-size":"30px"}},[t._v("\n                        資料處理中\n                    ")]),t._v(" "),t.showGooglSupport?a("google-support"):t._e()],1)])])])])};i._withStripped=!0;var n=a(104).a,s=a(9),o=Object(s.a)(n,i,[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"modal-header"},[e("h5",{staticClass:"modal-title"},[e("i",{staticClass:"fas fa-vote-yea"}),this._v("\n                        中獎名單\n                    ")]),this._v(" "),e("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[e("span",{attrs:{"aria-hidden":"true"}},[this._v("×")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("thead",[e("tr",[e("th",{staticStyle:{width:"15%"}},[this._v("\n                                        #\n                                    ")]),this._v(" "),e("th",{staticStyle:{width:"30%"}},[this._v("\n                                        姓名\n                                    ")]),this._v(" "),e("th",[this._v("獎項")]),this._v(" "),e("th",{staticStyle:{width:"20%"}},[this._v("\n                                        功能\n                                    ")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticClass:"text-center mb-3",staticStyle:{"font-size":"50px"}},[e("i",{staticClass:"fa-spin fas fa-sync"})])}],!1,null,"74243bd5",null);o.options.__file="components/ResultBox/main.vue";e.default=o.exports}}]);