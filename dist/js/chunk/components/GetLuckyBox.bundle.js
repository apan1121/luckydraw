(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{101:function(t,e,i){"use strict";(function(t){var r=i(2),a=i(0);function n(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function o(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(Object(i),!0).forEach((function(e){s(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function s(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var l={ding:new Audio("./dist/mp3/ding.mp3"),winner:[new Audio("./dist/mp3/winner2.mp3")]};e.a={components:{},filters:{},props:{},data:()=>({ValidateCandidateSN:null,ValidSNRandomRange:0,defaultRunTime:50,runTime:0,orgRunTime:0}),computed:o(o({},Object(r.c)(["config","triggerOpenGetLucky","prizeListByAward","candidateList","haveAwardCandidateSN","getLuckyWaitTimeArr"])),{},{needSetWebTitle(){var t=!1;return this.config.isTutorial||this.config.webTitle&&!["Lucky Draw","LuckyDraw","luckydraw"].includes(this.config.webTitle)||(t=!0),t}}),watch:{triggerOpenGetLucky:{immediate:!0,handler(){this.triggerOpenGetLucky?t(this.$refs.box).modal("show"):t(this.$refs.box).modal("hide")}}},created(){},mounted(){var e=this;t(e.$refs.box).bind("shown.bs.modal",()=>{e.award="",a.g.mixpanel("GetLuckyOpen_click"),a.g.gtag("event","GetLuckyOpen_click")}),t(e.$refs.box).bind("hidden.bs.modal",()=>{a.g.mixpanel("GetLuckyClose_click"),a.g.gtag("event","GetLuckyClose_click")}),e.triggerOpenGetLucky?t(e.$refs.box).modal("show"):t(e.$refs.box).modal("hide")},updated(){},destroyed(){},methods:o(o({},Object(r.d)({setFavicon:"setFavicon",setFocusCandidateSN:"setFocusCandidateSN",setFocusPrizeSN:"setFocusPrizeSN",triggerModal:"triggerModal"})),{},{gotoSetWebTitle(){var t=this;t.triggerModal({key:"GetLucky",close:!0});var e={offset:{top:60,bottom:60},startCallback(){a.g.mixpanel("TutorialStart_trigger",{type:"WebsiteTitle"}),a.g.gtag("event","TutorialStart_trigger",{type:"WebsiteTitle"})},closeCallback(){a.g.mixpanel("TutorialEnd_trigger",{type:"WebsiteTitle"}),a.g.gtag("event","TutorialEnd_trigger",{type:"WebsiteTitle"})},step_callback(t,e){a.g.mixpanel("TutorialStep_trigger",{type:"WebsiteTitle",index:e.index}),a.g.gtag("event","TutorialStep_trigger",{type:"WebsiteTitle",index:e.index})}},i=[{target:'#SettingBox input[name="webTitle"]',title:"獨特的抽獎",intro:"在抽獎前，設定一個屬於您的獨特抽獎活動名稱。",beforeAction(e,i,r){t.triggerModal({key:"Setting"}),setTimeout(()=>{r()},10)}}];new a.a(i,e).run()},editPrizeList(){t(this.$refs.box).modal("hide"),this.triggerModal({key:"PrizeList"})},getLucky(e){if(a.g.mixpanel("GetLuckyChoosePrize_click",e),a.g.gtag("event","GetLuckyChoosePrize_click",e),e.count<=e.amount){var i=this.haveAwardCandidateSN,r=[];this.candidateList.forEach(t=>{!1!==t.del||i.includes(t.sn)||r.push(t.sn)}),r.length>0?(this.ValidateCandidateSN=r,this.ValidSNRandomRange=Math.pow(10,"".concat(this.ValidateCandidateSN.length).length),t(this.$refs.box).modal("hide"),this.runTime=this.config.defaultRunTime,this.orgRunTime=this.config.defaultRunTime,a.g.mixpanel("GetLuckyChoosePrizeRun_trigger",e),a.g.gtag("event","GetLuckyChoosePrizeRun_trigger",e),this.setFocusCandidateSN(null),this.setFocusPrizeSN(e.prize_sn),this.luckyAction()):(a.g.mixpanel("GetLuckyChoosePrizeError_trigger",{error:"no candidate"}),a.g.gtag("event","GetLuckyChoosePrizeError_trigger",{error:"no candidate"}),a.e.warning({html:"無候選人可以抽"}))}else a.g.mixpanel("GetLuckyChoosePrizeError_trigger",{error:"not enough"}),a.g.gtag("event","GetLuckyChoosePrizeError_trigger",{error:"not enough"}),a.e.warning({html:"此獎項沒有足夠的數量"})},luckyAction(){var t=this,e=parseInt(1e5*Math.random()%t.ValidateCandidateSN.length);t.setFocusCandidateSN(t.ValidateCandidateSN[e]),l.ding.play(),t.setFavicon("run");var i=t.getLuckyWaitTimeArr;if(t.runTime>0&&t.ValidateCandidateSN.length>1){var r=0;if(t.orgRunTime<10)r=100;else for(var n in i)if(t.runTime>=i[n].limit){r=i[n].wait;break}console.log("waitTime",r),t.runTime-=1,clearTimeout(t.luckyActionTimer),t.luckyActionTimer=setTimeout(()=>{l.ding.pause(),l.ding.currentTime=0,t.luckyAction()},r)}else setTimeout(()=>{a.g.mixpanel("GetLuckyChoosePrizeStop_trigger"),a.g.gtag("event","GetLuckyChoosePrizeStop_trigger"),t.triggerModal({key:"Lucky"});var e=parseInt(10*Math.random()%l.winner.length);l.winner[e].play()},600)}})}}).call(this,i(14))},357:function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t._self._c;return e("div",{ref:"box",staticClass:"modal",attrs:{id:"GetLuckyBox",tabindex:"-1",role:"dialog","data-backdrop":"static","data-keyboard":"false"}},[e("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[e("div",{staticClass:"modal-content"},[t._m(0),t._v(" "),e("div",{staticClass:"modal-body"},[t.needSetWebTitle?e("div",{staticClass:"alert alert-primary",staticStyle:{flex:"0 0 auto"},attrs:{role:"alert"}},[t._v("\n                    請先設定屬於您的抽獎活動名稱\n                    "),e("button",{staticClass:"btn btn-success btn-sm",on:{click:t.gotoSetWebTitle}},[t._v("立刻去")])]):t._e(),t._v(" "),e("div",{staticClass:"get-lucky-list",class:{disabled:t.needSetWebTitle}},[t.prizeListByAward.length>0?t._l(t.prizeListByAward,(function(i){return e("button",{key:i.prize_sn,staticClass:"btn btn-success btn-lg btn-block mb-3 prizeInfo",attrs:{type:"button",disabled:i.amount<=i.count},on:{click:function(e){return t.getLucky(i)}}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-9"},[t._v("\n                                    "+t._s(i.title)+"\n                                ")]),t._v(" "),e("div",{staticClass:"col-3"},[t._v("\n                                    ["+t._s(i.count)+" / "+t._s(i.amount)+"]\n                                ")])])])})):[e("h4",{staticClass:"text-center p-3"},[t._v("\n                            您尚未建立獎項，無法進行抽獎\n                        ")]),t._v(" "),e("button",{staticClass:"btn btn-warning btn-block btn-lg",on:{click:t.editPrizeList}},[t._v("\n                            建立獎項\n                        ")])]],2)])])])])};r._withStripped=!0;var a=i(101).a,n=i(9),o=Object(n.a)(a,r,[function(){var t=this._self._c;return t("div",{staticClass:"modal-header"},[t("h5",{staticClass:"modal-title"},[t("i",{staticClass:"fas fa-vote-yea"}),this._v("\n                    選取獎項\n                ")]),this._v(" "),t("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[t("span",{attrs:{"aria-hidden":"true"}},[this._v("×")])])])}],!1,null,"78a97d2e",null);e.default=o.exports}}]);